{% extends "admin/base_site.html" %}

<!-- LOADING -->
{% load admin_list i18n grp_tags admin_urls %}

<!-- STYLESHEETS -->
{% block stylesheets %}
    {{ block.super }}
    {{ media.css }}

    <style>
    /* Thème moderne & épuré pour la page change-list */
    :root{
        --bg: #f4f7f6;
        --card: #ffffff;
        --accent: #16a34a;
        --accent-dark: #0b5a2b;
        --muted: #6b7280;
        --surface: #fafdf9;
        --radius: 12px;
        --shadow-sm: 0 6px 18px rgba(11,90,43,0.06);
        --shadow-lg: 0 12px 36px rgba(11,90,43,0.08);
        --gap: 14px;
    }

    /* Layout principal */
    body, .grp-change-list { background: var(--bg); color: #0f1724; font-family: Inter, system-ui, -apple-system, "Helvetica Neue", Arial, sans-serif; }
    .l-2cr-fluid { display:flex; gap: 20px; align-items:flex-start; }

    /* Filtres (carte) */
    #grp-filters {
        background: linear-gradient(180deg, rgba(22,163,74,0.03), rgba(11,90,43,0.01));
        border-radius: var(--radius);
        padding: 16px;
        border: 1px solid rgba(11,90,43,0.06);
        box-shadow: var(--shadow-sm);
    }
    #grp-filters h2 { margin:0 0 12px; color: var(--accent-dark); font-weight:700; font-size:1rem; }

    /* Module résultat (carte) */
    .grp-module.grp-changelist-results {
        background: transparent;
        margin-bottom: 18px;
    }
    .grp-module { background: transparent; }

    /* Table moderne */
    .grp-table, table, #result_list {
        width: 100%;
        border-collapse: collapse;
        background: var(--card);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        border: 1px solid rgba(11,90,43,0.04);
    }

    /* Entêtes : fond vert dégradé + texte blanc */
    .grp-table thead th,
    #result_list thead th {
        background: linear-gradient(90deg, var(--accent) 0%, var(--accent-dark) 100%);
        color: #ffffff !important;
        font-weight: 700;
        padding: 12px 16px;
        text-align: left;
        vertical-align: middle;
        font-size: 0.95rem;
        white-space: nowrap;
    }
    .grp-table thead th .grp-text,
    #result_list thead th .grp-text { color: #fff !important; }

    /* Cellules */
    .grp-table td, #result_list tbody td {
        padding: 12px 16px;
        border-bottom: 1px solid #eef6ef;
        color: #0f1724;
        font-size: 0.95rem;
        background: transparent;
    }
    .grp-table tr:nth-child(even), #result_list tbody tr:nth-child(even) { background: var(--surface); }
    .grp-table tr:hover, #result_list tbody tr:hover { background: #eefaf0; }

    /* Checkboxes colonne */
    #result_list tbody td.action-checkbox { width: 48px; text-align:center; }
    input[type="checkbox"] { width:18px; height:18px; accent-color: var(--accent-dark); }

    /* Boutons actions (Imprimer, Apply, Reset, Save) */
    .grp-button, .button, input[type="submit"] {
        background: linear-gradient(90deg, var(--accent-dark), var(--accent)) !important;
        color:#fff !important;
        border:none !important;
        padding:8px 14px;
        border-radius:10px;
        font-weight:700;
        cursor:pointer;
        box-shadow: 0 8px 20px rgba(11,90,43,0.08);
    }
    .grp-button:hover, .button:hover, input[type="submit"]:hover { transform: translateY(-2px); }

    /* Boutons 'Imprimer' dans chaque ligne */
    #result_list tbody td .btn-print {
        display:inline-block;
        padding:8px 12px;
        border-radius:8px;
        background: linear-gradient(90deg,#28a745,#138e3c);
        color:#fff;
        font-weight:700;
        border: none;
        box-shadow: 0 6px 12px rgba(251, 251, 251, 0.08);
    }

    /* Barre d'actions / footer */
    footer.grp-submit-row, .grp-changelist-actions {
        background: linear-gradient(180deg, rgba(22,163,74,0.02), rgba(11,90,43,0.01));
        border-radius: 10px;
        padding: 10px;
        display:flex;
        gap:12px;
        justify-content:flex-end;
        align-items:center;
        border:1px solid rgba(11,90,43,0.02);
    }
    .grp-action-counter { padding:6px 10px; background:#f1fbf5; border-radius:8px; color:var(--accent-dark); font-weight:600; }

    /* Footer sticky bottom non intrusif */
    .grp-fixed-footer {
        position: sticky !important;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 120;
        backdrop-filter: blur(6px);
    }

    /* Responsive : layout colonne sur petits écrans + cartes */
    @media (max-width: 1000px) {
        .l-2cr-fluid { flex-direction:column; }
        .c-1, .c-2, aside.c-1 { width:100% !important; }
        #grp-filters { order:-1; }
    }
    @media (max-width: 760px) {
        #result_list thead { display:none; }
        #result_list tbody tr { display:block; margin-bottom:12px; background:var(--card); border-radius:10px; padding:10px; box-shadow: var(--shadow-sm); }
        #result_list tbody td { display:flex; justify-content:space-between; padding:8px 10px; border-bottom:none; }
        #result_list tbody td::before { content: attr(data-label); font-weight:700; color:var(--muted); width:45%; text-align:left; }
        #result_list tbody td > * { flex:1 1 auto; text-align:right; }
        .grp-button { width:100%; }
    }

    /* Utilitaires */
    .muted { color: var(--muted); }
    .help-text { font-size:0.92rem; color:var(--muted); }

    </style>
{% endblock %}

<!-- JAVASCRIPTS -->
{% block javascripts %}
    {{ block.super }}
    {{ media.js }}
    {% if cl.formset or action_form %}
        {% url 'admin:jsi18n' as jsi18nurl %}
        <script type="text/javascript" src="{{ jsi18nurl|default:'../../jsi18n/'}}"></script>
    {% endif %}

    <script type="text/javascript">
    // Ajuste dynamiquement le padding-top du body pour que le footer fixe
    // ne masque jamais le contenu. (compatible avec responsive)
    (function () {
      function adjustFooterPaddingTop() {
        var footer = document.querySelector('.grp-fixed-footer');
        if (!footer) return;
        var h = footer.offsetHeight || 0;
        document.body.style.paddingTop = h + 'px';
      }
      window.addEventListener('load', adjustFooterPaddingTop);
      window.addEventListener('resize', adjustFooterPaddingTop);
      // cas où DOM est modifié après chargement
      setTimeout(adjustFooterPaddingTop, 120);
    })();
    </script>
{% endblock %}

<!-- BODY / BREADCRUMBS / CONTENT (inchangés, stylés ci‑dessus) -->
{% block bodyclass %}grp-change-list{% endblock %}
{% block content-class %}{% endblock %}

{% block breadcrumbs %}
    {% if not is_popup %}
        <ul class="grp-horizontal-list">
            <li><a href="{% url 'admin:index' %}">{% trans "Home" %}</a></li>
            <li><a href="{% url 'admin:app_list' app_label=cl.opts.app_label %}">{{ cl.opts.app_config.verbose_name }}</a></li>
            <li>{{ cl.opts.verbose_name_plural|capfirst }}</li>
        </ul>
    {% endif %}
{% endblock %}

{% block content_title %}
    <h1>{{ cl.opts.verbose_name_plural|capfirst }}</h1>
{% endblock %}

{% block object-tools %}
    <ul class="grp-object-tools">
        {% block object-tools-items %}
            {% if has_add_permission %}
                {% url cl.opts|admin_urlname:'add' as add_url %}
                <li><a href="{% add_preserved_filters add_url is_popup %}" class="grp-add-link grp-state-focus">{% blocktrans with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}</a></li>
             {% endif %}
        {% endblock %}
    </ul>
{% endblock %}

{% block content %}
    <div class="l-2cr-fluid{% if cl.has_filters %} l-d-6{% endif %}">
        {% if cl.has_filters %}
            <div class="c-1">
                {% block filters %}
                    <div id="grp-filters" class="grp-module grp-filter">
                        <h2>{% trans 'Filter' %}</h2>
                        {% for spec in cl.filter_specs %}{% admin_list_filter cl spec %}{% endfor %}
                        <div class="grp-module" style="margin-top:8px;">
                            <div class="grp-row">
                                <a href="" role="button" id="grp-filter-apply" class="grp-button">{% trans 'Apply' %}</a>
                                <a href="?" id="grp-filter-clear" class="grp-button grp-reset-link">{% trans 'Reset' %}</a>
                            </div>
                        </div>
                    </div>
                {% endblock %}
            </div>
        {% endif %}
        <div class="c-2">
            <div class="grp-module">
                <div class="grp-row">
                    <div class="l-2cr-fluid{% if cl.search_fields %} l-d-6{% endif %}">
                        {% if cl.has_filters or cl.search_fields %}
                            {% block aside %}
                                <aside class="c-1">
                                    {% if cl.search_fields %}
                                        <div id="search" class="g-d-6 g-d-f g-d-l">
                                            {% search_form cl %}
                                        </div>
                                    {% endif %}
                                </aside>
                            {% endblock %}
                        {% endif %}
                        {% block pagination_top %}
                            <div class="c-2">{% pagination cl %}</div>
                        {% endblock %}
                    </div>
                </div>
                {% block date_hierarchy %}{% if cl.date_hierarchy %}{% date_hierarchy cl %}{% endif %}{% endblock %}
            </div>

            <form id="grp-changelist-form" action="" method="post"{% if cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %} novalidate>{% csrf_token %}
                <section id="grp-changelist" class="{% if cl.list_editable %} grp-editable{% endif %}">
                    <header style="display:none"><h1>Results</h1></header>
                    {% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
                    {% if cl.formset.errors %}
                        <p class="errornote">
                            {% if cl.formset.errors|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}
                        </p>
                        {{ cl.formset.non_form_errors }}
                    {% endif %}
                    {% if cl.formset %}{{ cl.formset.management_form }}{% endif %}
                    {% block result_list %}{% result_list cl %}{% endblock %}
                </section>

                {% if not cl.result_count == 0 %}
                    {% block pagination_bottom %}
                        <div class="grp-module">
                            <div class="grp-row">{% pagination cl %}</div>
                        </div>
                    {% endblock %}
                {% endif %}

                {% if cl.formset or action_form %}
                    <footer id="submit" class="grp-module grp-submit-row grp-fixed-footer">
                        <ul>
                            {% if action_form %}<li class="grp-float-left grp-changelist-actions">{% admin_actions %}</li>{% endif %}
                            {% if cl.formset %}<li><input type="submit" class="grp-button grp-default" name="_save" value="{% trans 'Save' %}"/></li>{% endif %}
                        </ul>
                    </footer>
                {% endif %}
            </form>
        </div>
    </div>
{% endblock %}
